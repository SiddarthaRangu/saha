generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

// 1. User Identity & Access
model User {
  id            String    @id @default(cuid())
  email         String    @unique
  passwordHash  String
  name          String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  resumes       Resume[]
  applications  JobApplication[]
  usageLogs     AIRequestLog[]
}

// 2. Guest Usage (Rate Limiting)
model GuestUsage {
  ipAddress     String    @id
  requestCount  Int       @default(0)
  lastReset     DateTime  @default(now())
}

// 3. Core Domain Models
model Resume {
  id            String   @id @default(cuid())
  userId        String?
  label         String   @default("Master Resume")
  extractedText String   @db.Text
  fileUrl       String?
  createdAt     DateTime @default(now())

  user          User?    @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model JobApplication {
  id            String    @id @default(cuid())
  userId        String
  companyName   String
  roleTitle     String
  jdText        String    @db.Text
  status        Status    @default(BOOKMARKED)
  matchScore    Int?
  notes         String?   @db.Text
  appliedDate   DateTime?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  user          User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Relations to generated content
  coverLetters  GeneratedContent[]
}

model GeneratedContent {
  id            String    @id @default(cuid())
  applicationId String
  type          ContentType
  content       String    @db.Text
  createdAt     DateTime  @default(now())

  application   JobApplication @relation(fields: [applicationId], references: [id], onDelete: Cascade)
}

// 4. Analytics & Cost Control
model AIRequestLog {
  id            String   @id @default(cuid())
  userId        String?
  provider      String
  tokensUsed    Int
  feature       String
  createdAt     DateTime @default(now())

  user          User?    @relation(fields: [userId], references: [id])
}

enum Status {
  BOOKMARKED
  APPLIED
  INTERVIEWING
  OFFERED
  REJECTED
}

enum ContentType {
  COVER_LETTER
  LINKEDIN_MESSAGE
  COLD_EMAIL
}
